asmlinkage long CVE_2005_3356_VULN_sys_mq_open(const char __user *u_name, int oflag, mode_t struct mq_attr __user *u_attr) struct dentry * dentry ; char * name ; int fd , error ; if ( IS_ERR ( name = getname ( u_name ) ) )  fd = get_unused_fd ( ); if ( fd < 0 )  dentry = lookup_one_len ( name , mqueue_mnt -> mnt_root , strlen ( name ) ); if ( IS_ERR ( dentry ) )  error = PTR_ERR ( dentry ); if ( dentry -> d_inode )  filp = ( oflag & O_EXCL ) ? ERR_PTR ( - EEXIST ) : do_open ( dentry , oflag ); filp = do_create ( mqueue_mnt -> mnt_root , dentry , oflag , mode , u_attr ); filp = ( dentry -> d_inode ) ? do_open ( dentry , oflag ) : ERR_PTR ( - ENOENT ); dput ( dentry ); if ( IS_ERR ( filp ) )  error = PTR_ERR ( filp ); fd_install ( fd , filp ); fd = error; return fd ; 